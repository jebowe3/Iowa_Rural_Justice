<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Iowa Rural Justice Project</title>
  <link rel="icon" type="image/jpg" href="images/icon.jpg" />
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <!-- for button-dependent map information window -->
  <link rel='stylesheet' href='https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css'>

  <link href='https://api.mapbox.com/mapbox-assembly/v0.8.0/assembly.min.css' rel='stylesheet'>
  <link href='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.css' rel='stylesheet' />
  <link href="https://fonts.googleapis.com/css?family=Rubik&display=swap" rel="stylesheet">

  <!-- for easy buttons -->
  <link rel="stylesheet" href="src/easy-button.css">

  <!-- for grouped layer control -->
  <link rel="stylesheet" href="src/leaflet.groupedlayercontrol.css" />

  <style type="text/css">
    h1 {
      font-size: 30px;
      font-family: 'Rubik', sans-serif;
      display: inline-block;
      color: white;
      margin-left: 18px;
      margin-right: 30px;
      padding-top: 20px;
      padding-bottom: 10px;
    }

    h2 {
      font-size: 16px;
      font-family: 'Rubik', sans-serif;
      padding-bottom: 0px;
      padding-top: 0px;
    }

    h3 {
      font-size: 12px;
      font-family: 'Rubik', sans-serif;
      padding-top: 0px;
    }

    h4 {
      font-size: 14px;
      font-family: 'Rubik', sans-serif;
      display: inline-block;
      margin-right: 16px;
      margin-left: 19px;
      padding-bottom: 1px;
      color: white;
    }

    h5 {
      font-size: 14px;
      font-family: 'Rubik', sans-serif;
      padding-bottom: 0px;
      padding-top: 4px;
    }

    h6 {
      font-size: 14px;
      font-family: 'Rubik', sans-serif;
      padding-top: 0px;
    }

    body {
      margin: 0px;
      height: 100%;
      width: 100%;
    }

    /* Add banner to header background */
    header {
      background-image: url('images/Iowa_Prairie.jpg');
      position: fixed;
      width: 100%;
      height: 100px;
      background-color: #000000;
      box-shadow: 0px 5px 5px black;
      z-index: 800;
    }

    /* Set map parameters */
    #map {
      position: fixed;
      top: 100px;
      bottom: 0px;
      width: 100%;
    }

    #info_text {
      background-color: #FFFFFF;
      padding-bottom: 10px;
      padding-left: 5px;
      height: 30px;
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      position: absolute;
      z-index: 10;
      top: 40px;
      right: 125px;
    }

    #map1button {
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      position: fixed;
      z-index: 10;
      top: 150px;
      right: 94px;
    }

    #map2button {
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      position: fixed;
      z-index: 10;
      top: 150px;
      right: 53px;
    }

    #infoButton {
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      position: fixed;
      z-index: 10;
      top: 150px;
      right: 12px;
    }

    .legend {
      background-color: #fff;
      border-radius: 3px;
      bottom: 30px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.10);
      font: 12px/20px 'Rubik', 'Rubik', 'Rubik', sans-serif;
      padding: 10px;
      position: absolute;
      right: 10px;
      z-index: 1;
      line-height: 18px;
      color: #555;
    }

    .legend i {
      width: 50px;
      height: 18px;
      float: left;
      margin-right: 25px;
      opacity: 0.7;
    }

    .leaflet-control-layers-expanded {
      font-family: 'Rubik', sans-serif;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <header>
    <h1>Iowa Rural Justice Project: ILA Calls by Legal Category Compared to US Census ACS Data</h1><br>
    <h4>Map by Jay Bowen, 2020 | University of Iowa Digital Scholarship & Publishing Studio</h4>
  </header>
  <div id="map">
    <!-- maps title -->
    <div id='info_text' class='px12 round wmax200'>
      <h5 class='txt-bold'>Maps:</h5>
    </div>
    <!-- end maps title -->
  </div>

  <!-- calls information window -->
  <div id='info' class='py6 px12 bg-gray-faint border border--gray-light round absolute wmax200 none'>
    <h2 class='txt-bold'><span></span></h2>
    <div class='grid'>
      <nav class='col3'>
        <h6 class='Data'> <span class='txt-bold'></span></h6>
        <p class='Consumer'> <svg class='icon inline-block' style='color: #ff0000'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Education'> <svg class='icon inline-block' style='color: #ff7700'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Employment'> <svg class='icon inline-block' style='color: #ffff00'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Family'> <svg class='icon inline-block' style='color: #77ff00'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Minors'> <svg class='icon inline-block' style='color: #00ffff'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Health'> <svg class='icon inline-block' style='color: #0000ff'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Housing'> <svg class='icon inline-block' style='color: #7700ff'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Benefits'> <svg class='icon inline-block' style='color: #ff00ff'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Individual'> <svg class='icon inline-block' style='color: #ff0077'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
        <p class='Misc'> <svg class='icon inline-block' style='color: #C0C0C0'>
            <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      </nav>
      <div class='col6 flex-parent flex-parent--center-cross'>
        <p class='mb6 flex-child'><span class='callspark'></span></p>
      </div>
    </div>
    <!-- end grid -->
  </div>
  <!-- end info -->

  <!-- pearson information window -->
<div id='pearsoninfo' class='py6 px12 bg-gray-faint border border--gray-light round bottom left absolute wmax200 none'>
  <h2 class='txt-bold'><span></span></h2>
  <div class='grid'>
    <nav class='col3'>
      <h6 class='Head'> <span class='txt-bold'></span></h6>
      <p class='consumer'> <svg class='icon inline-block' style='color: #ff0000'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='education'> <svg class='icon inline-block' style='color: #ff7700'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='employment'> <svg class='icon inline-block' style='color: #ffff00'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='family'> <svg class='icon inline-block' style='color: #77ff00'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='minors'> <svg class='icon inline-block' style='color: #00ffff'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='health'> <svg class='icon inline-block' style='color: #0000ff'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='housing'> <svg class='icon inline-block' style='color: #7700ff'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='benefits'> <svg class='icon inline-block' style='color: #ff00ff'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='individual'> <svg class='icon inline-block' style='color: #ff0077'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
      <p class='miscellaneous'> <svg class='icon inline-block' style='color: #C0C0C0'>
          <use xlink:href='#icon-circle' /></svg> <span class='txt-s'></span> </p>
    </nav>
    <div class='col6 flex-parent flex-parent--center-cross'>
      <p class='mb6 flex-child'><span class='pearsonspark'></span></p>
    </div>
  </div>
  <!-- end grid -->
</div>
<!-- end pearsoninfo -->

  <!-- button-dependent info window -->
  <div id="dialog" title="ILA calls by legal category">
    <h3>This map compares calls for Iowa Legal Aid services by legal category to
      several social indicators measured by the US Census American Community Survey.
      You can maximize the layer controls in the upper right corner to toggle these
      data for each county. Click on the map polygons for more detailed information.
      You will see that clicking on ILA polygons will open a pie chart that breaks
      down the proportion of calls received for each legal category from that county.
      By clicking on the ACS polygons, you will see both details about that county,
      as well as a Pearson Correlation Coefficient measurement comparing the strength
      or weakness of that social metric's correlation to each legal category of ILA
      calls received. You can also cycle through other maps in the project by clicking
      on the numbered buttons below the layer controls. These maps were designed
      to be displayed in Firefox.</h3>
  </div>
  <!-- end button-dependent info window -->

  <!-- load scripts -->
  <script src='https://api.mapbox.com/mapbox-assembly/v0.8.0/assembly.js'></script>
  <script src='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.js'></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <!-- for pie charts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sparklines/2.1.2/jquery.sparkline.min.js"></script>

  <!-- for button-dependent map information window -->
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <!-- omnivore to handle topojson files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-omnivore/0.3.4/leaflet-omnivore.min.js"></script>

  <!-- papaparse to parse csv files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>

  <!-- for easy buttons -->
  <script src="src/easy-button.js"></script>

  <!-- for grouped layer control -->
  <script src="src/leaflet.groupedlayercontrol.js"></script>

  <script type="text/javascript">
    // Initialize the map
    var map = L.map('map').setView([42.065, -93.500], 8);

    // Load tile layer
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 16,
      minZoom: 7,
    }).addTo(map);
    /*
        // fit map to Iowa
        map.fitBounds([
          [43.50102, -90.14006],
          [40.37544, -96.63967]
        ]);
    */
    // if the browser is Chrome...
    if (L.Browser.webkit) {
      /*
       * Workaround for 1px lines appearing in some browsers due to fractional transforms
       * and resulting anti-aliasing.
       * https://github.com/Leaflet/Leaflet/issues/3575
       */
      (function() {
        var originalInitTile = L.GridLayer.prototype._initTile
        L.GridLayer.include({
          _initTile: function(tile) {
            originalInitTile.call(this, tile);

            var tileSize = this.getTileSize();

            tile.style.width = tileSize.x + 1 + 'px';
            tile.style.height = tileSize.y + 1 + 'px';
          }
        });
      })()
    };

    // add a scale bar
    L.control.scale().addTo(map);

    // Add a function to style the counties by percent of calls for consumer protection (jenks)
    function getColorProtect(d) {
      return d > 18.99 ? '#bd0026' :
        d > 14.61 ? '#f03b20' :
        d > 11.70 ? '#fd8d3c' :
        d > 8.64 ? '#fecc5c' :
        d >= 4.82 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for education (jenks)
    function getColorEd(d) {
      return d > 1.56 ? '#bd0026' :
        d > 1.09 ? '#f03b20' :
        d > 0.65 ? '#fd8d3c' :
        d > 0.21 ? '#fecc5c' :
        d >= 0.00 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for employment/tax (jenks)
    function getColorEmp(d) {
      return d > 4.53 ? '#bd0026' :
        d > 3.35 ? '#f03b20' :
        d > 2.39 ? '#fd8d3c' :
        d > 0.76 ? '#fecc5c' :
        d >= 0.00 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for family (jenks)
    function getColorFam(d) {
      return d > 40.00 ? '#bd0026' :
        d > 34.92 ? '#f03b20' :
        d > 30.11 ? '#fd8d3c' :
        d > 25.60 ? '#fecc5c' :
        d >= 20.88 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for minors (jenks)
    function getColorMinors(d) {
      return d > 6.25 ? '#bd0026' :
        d > 4.23 ? '#f03b20' :
        d > 2.71 ? '#fd8d3c' :
        d > 1.33 ? '#fecc5c' :
        d >= 0.00 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for health (jenks)
    function getColorHealth(d) {
      return d > 12.68 ? '#bd0026' :
        d > 9.26 ? '#f03b20' :
        d > 7.11 ? '#fd8d3c' :
        d > 5.10 ? '#fecc5c' :
        d >= 2.08 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for housing (jenks)
    function getColorHousing(d) {
      return d > 31.50 ? '#bd0026' :
        d > 27.64 ? '#f03b20' :
        d > 23.44 ? '#fd8d3c' :
        d > 17.33 ? '#fecc5c' :
        d >= 7.04 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for benefits (jenks)
    function getColorBenefits(d) {
      return d > 13.51 ? '#bd0026' :
        d > 10.24 ? '#f03b20' :
        d > 8.37 ? '#fd8d3c' :
        d > 5.73 ? '#fecc5c' :
        d >= 1.27 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for individual rights (jenks)
    function getColorIndividual(d) {
      return d > 2.74 ? '#bd0026' :
        d > 1.69 ? '#f03b20' :
        d > 0.99 ? '#fd8d3c' :
        d > 0.01 ? '#fecc5c' :
        d >= 0.00 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of calls for miscellaneous/other (jenks)
    function getColorMisc(d) {
      return d > 8.21 ? '#bd0026' :
        d > 6.03 ? '#f03b20' :
        d > 4.23 ? '#fd8d3c' :
        d > 2.53 ? '#fecc5c' :
        d >= 1.27 ? '#ffffb2' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of families below poverty (jenks)
    function getShadeFams(d) {
      return d > 11.50 ? '#006837' :
        d > 9.04 ? '#31a354' :
        d > 7.07 ? '#78c679' :
        d > 5.18 ? '#c2e699' :
        d >= 3.01 ? '#ffffcc' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by GINI Coefficient (jenks)
    function getShadeGini(d) {
      return d > 0.4744 ? '#006837' :
        d > 0.4409 ? '#31a354' :
        d > 0.4185 ? '#78c679' :
        d > 0.3920 ? '#c2e699' :
        d >= 0.3765 ? '#ffffcc' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of families paying more than 50% of income to rent (jenks)
    function getShadeRent(d) {
      return d > 24.92 ? '#006837' :
        d > 17.61 ? '#31a354' :
        d > 13.04 ? '#78c679' :
        d > 8.50 ? '#c2e699' :
        d >= 4.20 ? '#ffffcc' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of 18+ population veterans (jenks)
    function getShadeVet(d) {
      return d > 9.76 ? '#006837' :
        d > 8.97 ? '#31a354' :
        d > 7.73 ? '#78c679' :
        d > 6.06 ? '#c2e699' :
        d >= 4.44 ? '#ffffcc' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of population foreign born (jenks)
    function getShadeForeign(d) {
      return d > 12.89 ? '#006837' :
        d > 6.92 ? '#31a354' :
        d > 3.28 ? '#78c679' :
        d > 1.66 ? '#c2e699' :
        d >= 0.18 ? '#ffffcc' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of population uninsured (jenks)
    function getShadeUninsured(d) {
      return d > 12.53 ? '#006837' :
        d > 8.46 ? '#31a354' :
        d > 5.99 ? '#78c679' :
        d > 4.31 ? '#c2e699' :
        d >= 1.80 ? '#ffffcc' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    // Add a function to style the counties by percent of children in single parent households (jenks)
    function getShadeSingle(d) {
      return d > 33.35 ? '#006837' :
        d > 28.92 ? '#31a354' :
        d > 23.89 ? '#78c679' :
        d > 17.87 ? '#c2e699' :
        d >= 10.69 ? '#ffffcc' :
        'rgba(0,0,0,0.0)'; // supported by Microsoft Edge
    };

    var consumerLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorProtect(feature.properties.Consumer_Protection_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html('<b>' + props.Consumer_Protection_Int + '% Consumer Protection' + '</b>'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          consumerLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var educationLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorEd(feature.properties.Education_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html('<b>' + props.Education_Int + '% Education</b>');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          educationLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var employLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorEmp(feature.properties.Employment_Tax_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html('<b>' + props.Employment_Tax_Int + '% Employment/Tax</b>');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          employLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var famLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorFam(feature.properties.Family_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html('<b>' + props.Family_Int + '% Family</b>');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          famLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var minorsLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorMinors(feature.properties.Minors_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html('<b>' + props.Minors_Int + '% Minors</b>');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          minorsLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var healthLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorHealth(feature.properties.Health_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html('<b>' + props.Health_Int + '% Health</b>');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          healthLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var housingLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorHousing(feature.properties.Housing_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html('<b>' + props.Housing_Int + '% Housing</b>');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          housingLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var benefitsLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorBenefits(feature.properties.Benefits_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html('<b>' + props.Benefits_Int + '% Benefits</b>');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          benefitsLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var individualLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorIndividual(feature.properties.Individual_Rights_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html('<b>' + props.Individual_Rights_Int + '% Individual Rights</b>');
          $(".Misc span").html(props.Misc_Int + '% Miscellaneous/Other');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          individualLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var miscLayer = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getColorMisc(feature.properties.Misc_Int),
          fillOpacity: 0.5,
        };
      },

      onEachFeature: function(feature, layer) {

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });
        // define what happens on click
        layer.on("click", function(e) {

          // remove the none class to display the element
          $('#info').removeClass('none').show

          // derive the properties of the target layer
          var props = layer.feature.properties;

          // create an empty array
          var infoVals = [];

          // push feature property values to the empty array
          infoVals.push(
            props['Consumer_Protection_Int'],
            props['Education_Int'],
            props['Employment_Tax_Int'],
            props['Family_Int'],
            props['Minors_Int'],
            props['Health_Int'],
            props['Housing_Int'],
            props['Benefits_Int'],
            props['Individual_Rights_Int'],
            props['Misc_Int']
          );

          // populate our info window HTML elements with the relevant information using jQuery
          $('#info span').html(props.COUNTY + ' County, ' + props.ST); // the name of the county the user is clicking on
          $(".Data span").html('ILA Calls by Legal Category:'); // header
          $(".Consumer span").html(props.Consumer_Protection_Int + '% Consumer Protection'); // the percentage of calls in each category
          $(".Education span").html(props.Education_Int + '% Education');
          $(".Employment span").html(props.Employment_Tax_Int + '% Employment/Tax');
          $(".Family span").html(props.Family_Int + '% Family');
          $(".Minors span").html(props.Minors_Int + '% Minors');
          $(".Health span").html(props.Health_Int + '% Health');
          $(".Housing span").html(props.Housing_Int + '% Housing');
          $(".Benefits span").html(props.Benefits_Int + '% Benefits');
          $(".Individual span").html(props.Individual_Rights_Int + '% Individual Rights');
          $(".Misc span").html('<b>' + props.Misc_Int + '% Miscellaneous/Other</b>');

          // add a pie chart
          $('.callspark').sparkline(infoVals, {
            type: 'pie',
            height: '10.0em',
            sliceColors: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
          });
        });
        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          miscLayer.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#info').addClass('none').show
        });

      }
    });

    var famsPov = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getShadeFams(feature.properties.Perc_Families_Below_Poverty),
          fillOpacity: 1,
        };
      },

      onEachFeature: function(feature, layer) {

        // bind a popup window
        layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, IA</b><br>' + feature.properties.Perc_Families_Below_Poverty + '% of families in poverty</h2>');

        // change layer style on mouseover
        layer.on("mouseover", function(e) {

          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });

        });

        layer.on("click", function(e) {
          Papa.parse('data/Pearsons.csv', {
            header: true,
            download: true,
            dynamicTyping: true,
            complete: function(results) {
              data = results.data;

              var array = [];

              array.push(data[0].Families_Below_Poverty_Perc, data[1].Families_Below_Poverty_Perc,
                             data[2].Families_Below_Poverty_Perc, data[3].Families_Below_Poverty_Perc,
                             data[4].Families_Below_Poverty_Perc, data[5].Families_Below_Poverty_Perc,
                             data[6].Families_Below_Poverty_Perc, data[7].Families_Below_Poverty_Perc,
                             data[8].Families_Below_Poverty_Perc, data[9].Families_Below_Poverty_Perc
                            );

              // remove the none class to display the element
              $('#pearsoninfo').removeClass('none').show();

              // populate our info window HTML elements with the relevant information using jQuery
              $('#pearsoninfo span').html('For percent of families in poverty,');
              $(".Head span").html("the Pearson correlation coefficient is: ");
              $(".consumer span").html(data[0].Families_Below_Poverty_Perc.toFixed(2) + ' with Consumer Protection Calls');
              $(".education span").html(data[1].Families_Below_Poverty_Perc.toFixed(2) + ' with Education Calls');
              $(".employment span").html(data[2].Families_Below_Poverty_Perc.toFixed(2) + ' with Employment Calls');
              $(".family span").html(data[3].Families_Below_Poverty_Perc.toFixed(2) + ' with Family Calls');
              $(".minors span").html(data[4].Families_Below_Poverty_Perc.toFixed(2) + ' with Minors Calls');
              $(".health span").html(data[5].Families_Below_Poverty_Perc.toFixed(2) + ' with Health Calls');
              $(".housing span").html(data[6].Families_Below_Poverty_Perc.toFixed(2) + ' with Housing Calls');
              $(".benefits span").html(data[7].Families_Below_Poverty_Perc.toFixed(2) + ' with Benefits Calls');
              $(".individual span").html(data[8].Families_Below_Poverty_Perc.toFixed(2) + ' with Individual Rights Calls');
              $(".miscellaneous span").html(data[9].Families_Below_Poverty_Perc.toFixed(2) + ' with Misc/Other Calls');
              $(".pearsonspark").sparkline(array, {
                type: 'bar',
                height: '10.0em',
                barWidth: '12.0em',
                colorMap: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
              });

            }
          });
        });

        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          famsPov.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#pearsoninfo').addClass('none').show

        });

      }
    });

    var gini = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getShadeGini(feature.properties.Gini),
          fillOpacity: 1,
        };
      },

      onEachFeature: function(feature, layer) {

        // bind a popup window
        layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, IA</b><br>Gini Coefficient: ' + feature.properties.Gini + '</h2>');

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });

        layer.on("click", function(e) {
          Papa.parse('data/Pearsons.csv', {
            header: true,
            download: true,
            dynamicTyping: true,
            complete: function(results) {
              data = results.data;

              var array = [];

              array.push(data[0].Gini_Index, data[1].Gini_Index,
                             data[2].Gini_Index, data[3].Gini_Index,
                             data[4].Gini_Index, data[5].Gini_Index,
                             data[6].Gini_Index, data[7].Gini_Index,
                             data[8].Gini_Index, data[9].Gini_Index
                            );

              // remove the none class to display the element
              $('#pearsoninfo').removeClass('none').show();

              // populate our info window HTML elements with the relevant information using jQuery
              $('#pearsoninfo span').html('For the Gini coefficient,');
              $(".Head span").html("the Pearson correlation coefficient is: ");
              $(".consumer span").html(data[0].Gini_Index.toFixed(2) + ' with Consumer Protection Calls');
              $(".education span").html(data[1].Gini_Index.toFixed(2) + ' with Education Calls');
              $(".employment span").html(data[2].Gini_Index.toFixed(2) + ' with Employment Calls');
              $(".family span").html(data[3].Gini_Index.toFixed(2) + ' with Family Calls');
              $(".minors span").html(data[4].Gini_Index.toFixed(2) + ' with Minors Calls');
              $(".health span").html(data[5].Gini_Index.toFixed(2) + ' with Health Calls');
              $(".housing span").html(data[6].Gini_Index.toFixed(2) + ' with Housing Calls');
              $(".benefits span").html(data[7].Gini_Index.toFixed(2) + ' with Benefits Calls');
              $(".individual span").html(data[8].Gini_Index.toFixed(2) + ' with Individual Rights Calls');
              $(".miscellaneous span").html(data[9].Gini_Index.toFixed(2) + ' with Misc/Other Calls');
              $(".pearsonspark").sparkline(array, {
                type: 'bar',
                height: '10.0em',
                barWidth: '12.0em',
                colorMap: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
              });

            }
          });
        });

        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          gini.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#pearsoninfo').addClass('none').show

        });

      }
    });

    var rent = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getShadeRent(feature.properties.Households_Rent_50Perc_Income_Perc),
          fillOpacity: 1,
        };
      },

      onEachFeature: function(feature, layer) {

        // bind a popup window
        layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, IA</b><br>' + feature.properties.Households_Rent_50Perc_Income_Perc + '% of households with rent > 50% of income</h2>');

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });

        layer.on("click", function(e) {
          Papa.parse('data/Pearsons.csv', {
            header: true,
            download: true,
            dynamicTyping: true,
            complete: function(results) {
              data = results.data;

              var array = [];

              array.push(data[0].Perc_Households_Rent_50Perc_Income, data[1].Perc_Households_Rent_50Perc_Income,
                             data[2].Perc_Households_Rent_50Perc_Income, data[3].Perc_Households_Rent_50Perc_Income,
                             data[4].Perc_Households_Rent_50Perc_Income, data[5].Perc_Households_Rent_50Perc_Income,
                             data[6].Perc_Households_Rent_50Perc_Income, data[7].Perc_Households_Rent_50Perc_Income,
                             data[8].Perc_Households_Rent_50Perc_Income, data[9].Perc_Households_Rent_50Perc_Income
                            );

              // remove the none class to display the element
              $('#pearsoninfo').removeClass('none').show();

              // populate our info window HTML elements with the relevant information using jQuery
              $('#pearsoninfo span').html('For households with rent > 50% of income,');
              $(".Head span").html("the Pearson correlation coefficient is: ");
              $(".consumer span").html(data[0].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Consumer Protection Calls');
              $(".education span").html(data[1].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Education Calls');
              $(".employment span").html(data[2].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Employment Calls');
              $(".family span").html(data[3].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Family Calls');
              $(".minors span").html(data[4].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Minors Calls');
              $(".health span").html(data[5].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Health Calls');
              $(".housing span").html(data[6].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Housing Calls');
              $(".benefits span").html(data[7].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Benefits Calls');
              $(".individual span").html(data[8].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Individual Rights Calls');
              $(".miscellaneous span").html(data[9].Perc_Households_Rent_50Perc_Income.toFixed(2) + ' with Misc/Other Calls');
              $(".pearsonspark").sparkline(array, {
                type: 'bar',
                height: '10.0em',
                barWidth: '12.0em',
                colorMap: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
              });

            }
          });
        });

        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          rent.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#pearsoninfo').addClass('none').show

        });

      }
    });

    var veteran = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getShadeVet(feature.properties.Veteran_Perc),
          fillOpacity: 1,
        };
      },

      onEachFeature: function(feature, layer) {

        // bind a popup window
        layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, IA</b><br>' + feature.properties.Veteran_Perc + '% of adults are veterans</h2>');

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });

        layer.on("click", function(e) {
          Papa.parse('data/Pearsons.csv', {
            header: true,
            download: true,
            dynamicTyping: true,
            complete: function(results) {
              data = results.data;

              var array = [];

              array.push(data[0].Perc_Veteran, data[1].Perc_Veteran,
                             data[2].Perc_Veteran, data[3].Perc_Veteran,
                             data[4].Perc_Veteran, data[5].Perc_Veteran,
                             data[6].Perc_Veteran, data[7].Perc_Veteran,
                             data[8].Perc_Veteran, data[9].Perc_Veteran
                            );

              // remove the none class to display the element
              $('#pearsoninfo').removeClass('none').show();

              // populate our info window HTML elements with the relevant information using jQuery
              $('#pearsoninfo span').html('For percent of adults who are veterans,');
              $(".Head span").html("the Pearson correlation coefficient is: ");
              $(".consumer span").html(data[0].Perc_Veteran.toFixed(2) + ' with Consumer Protection Calls');
              $(".education span").html(data[1].Perc_Veteran.toFixed(2) + ' with Education Calls');
              $(".employment span").html(data[2].Perc_Veteran.toFixed(2) + ' with Employment Calls');
              $(".family span").html(data[3].Perc_Veteran.toFixed(2) + ' with Family Calls');
              $(".minors span").html(data[4].Perc_Veteran.toFixed(2) + ' with Minors Calls');
              $(".health span").html(data[5].Perc_Veteran.toFixed(2) + ' with Health Calls');
              $(".housing span").html(data[6].Perc_Veteran.toFixed(2) + ' with Housing Calls');
              $(".benefits span").html(data[7].Perc_Veteran.toFixed(2) + ' with Benefits Calls');
              $(".individual span").html(data[8].Perc_Veteran.toFixed(2) + ' with Individual Rights Calls');
              $(".miscellaneous span").html(data[9].Perc_Veteran.toFixed(2) + ' with Misc/Other Calls');
              $(".pearsonspark").sparkline(array, {
                type: 'bar',
                height: '10.0em',
                barWidth: '12.0em',
                colorMap: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
              });

            }
          });
        });

        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          veteran.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#pearsoninfo').addClass('none').show

        });

      }
    });

    var foreignBorn = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getShadeForeign(feature.properties.Foreign_Born_Perc),
          fillOpacity: 1,
        };
      },

      onEachFeature: function(feature, layer) {

        // bind a popup window
        layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, IA</b><br>' + feature.properties.Foreign_Born_Perc + '% foreign born</h2>');

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });

        layer.on("click", function(e) {
          Papa.parse('data/Pearsons.csv', {
            header: true,
            download: true,
            dynamicTyping: true,
            complete: function(results) {
              data = results.data;

              var array = [];

              array.push(data[0].Perc_Foreign_Born, data[1].Perc_Foreign_Born,
                             data[2].Perc_Foreign_Born, data[3].Perc_Foreign_Born,
                             data[4].Perc_Foreign_Born, data[5].Perc_Foreign_Born,
                             data[6].Perc_Foreign_Born, data[7].Perc_Foreign_Born,
                             data[8].Perc_Foreign_Born, data[9].Perc_Foreign_Born
                            );

              // remove the none class to display the element
              $('#pearsoninfo').removeClass('none').show();

              // populate our info window HTML elements with the relevant information using jQuery
              $('#pearsoninfo span').html('For percent foreign born,');
              $(".Head span").html("the Pearson correlation coefficient is: ");
              $(".consumer span").html(data[0].Perc_Foreign_Born.toFixed(2) + ' with Consumer Protection Calls');
              $(".education span").html(data[1].Perc_Foreign_Born.toFixed(2) + ' with Education Calls');
              $(".employment span").html(data[2].Perc_Foreign_Born.toFixed(2) + ' with Employment Calls');
              $(".family span").html(data[3].Perc_Foreign_Born.toFixed(2) + ' with Family Calls');
              $(".minors span").html(data[4].Perc_Foreign_Born.toFixed(2) + ' with Minors Calls');
              $(".health span").html(data[5].Perc_Foreign_Born.toFixed(2) + ' with Health Calls');
              $(".housing span").html(data[6].Perc_Foreign_Born.toFixed(2) + ' with Housing Calls');
              $(".benefits span").html(data[7].Perc_Foreign_Born.toFixed(2) + ' with Benefits Calls');
              $(".individual span").html(data[8].Perc_Foreign_Born.toFixed(2) + ' with Individual Rights Calls');
              $(".miscellaneous span").html(data[9].Perc_Foreign_Born.toFixed(2) + ' with Misc/Other Calls');
              $(".pearsonspark").sparkline(array, {
                type: 'bar',
                height: '10.0em',
                barWidth: '12.0em',
                colorMap: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
              });

            }
          });
        });

        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          foreignBorn.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#pearsoninfo').addClass('none').show

        });

      }
    });

    var uninsured = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getShadeUninsured(feature.properties.Uninsured_Perc),
          fillOpacity: 1,
        };
      },

      onEachFeature: function(feature, layer) {

        // bind a popup window
        layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, IA</b><br>' + feature.properties.Uninsured_Perc + '% without health insurance</h2>');

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });

        layer.on("click", function(e) {
          Papa.parse('data/Pearsons.csv', {
            header: true,
            download: true,
            dynamicTyping: true,
            complete: function(results) {
              data = results.data;

              var array = [];

              array.push(data[0].Perc_Uninsured, data[1].Perc_Uninsured,
                             data[2].Perc_Uninsured, data[3].Perc_Uninsured,
                             data[4].Perc_Uninsured, data[5].Perc_Uninsured,
                             data[6].Perc_Uninsured, data[7].Perc_Uninsured,
                             data[8].Perc_Uninsured, data[9].Perc_Uninsured
                            );

              // remove the none class to display the element
              $('#pearsoninfo').removeClass('none').show();

              // populate our info window HTML elements with the relevant information using jQuery
              $('#pearsoninfo span').html('For percent without health insurance,');
              $(".Head span").html("the Pearson correlation coefficient is: ");
              $(".consumer span").html(data[0].Perc_Uninsured.toFixed(2) + ' with Consumer Protection Calls');
              $(".education span").html(data[1].Perc_Uninsured.toFixed(2) + ' with Education Calls');
              $(".employment span").html(data[2].Perc_Uninsured.toFixed(2) + ' with Employment Calls');
              $(".family span").html(data[3].Perc_Uninsured.toFixed(2) + ' with Family Calls');
              $(".minors span").html(data[4].Perc_Uninsured.toFixed(2) + ' with Minors Calls');
              $(".health span").html(data[5].Perc_Uninsured.toFixed(2) + ' with Health Calls');
              $(".housing span").html(data[6].Perc_Uninsured.toFixed(2) + ' with Housing Calls');
              $(".benefits span").html(data[7].Perc_Uninsured.toFixed(2) + ' with Benefits Calls');
              $(".individual span").html(data[8].Perc_Uninsured.toFixed(2) + ' with Individual Rights Calls');
              $(".miscellaneous span").html(data[9].Perc_Uninsured.toFixed(2) + ' with Misc/Other Calls');
              $(".pearsonspark").sparkline(array, {
                type: 'bar',
                height: '10.0em',
                barWidth: '12.0em',
                colorMap: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
              });

            }
          });
        });

        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          uninsured.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#pearsoninfo').addClass('none').show

        });

      }
    });

    var singleParents = L.geoJson(null, {
      // http://leafletjs.com/reference.html#geojson-style
      style: function(feature) {
        return {
          stroke: 1,
          color: 'grey',
          strokeOpacity: 1,
          weight: 1,
          fillColor: getShadeSingle(feature.properties.Children_Single_Parents_Perc),
          fillOpacity: 1,
        };
      },

      onEachFeature: function(feature, layer) {

        // bind a popup window
        layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, IA</b><br>' + feature.properties.Children_Single_Parents_Perc + '% of children in single-parent homes</h2>');

        // change layer style on mouseover
        layer.on("mouseover", function(e) {
          layer.setStyle({
            color: 'yellow',
            weight: 3,
            opacity: 1,
          });
        });

        layer.on("click", function(e) {
          Papa.parse('data/Pearsons.csv', {
            header: true,
            download: true,
            dynamicTyping: true,
            complete: function(results) {
              data = results.data;

              var array = [];

              array.push(data[0].Perc_Children_Single_Parents, data[1].Perc_Children_Single_Parents,
                             data[2].Perc_Children_Single_Parents, data[3].Perc_Children_Single_Parents,
                             data[4].Perc_Children_Single_Parents, data[5].Perc_Children_Single_Parents,
                             data[6].Perc_Children_Single_Parents, data[7].Perc_Children_Single_Parents,
                             data[8].Perc_Children_Single_Parents, data[9].Perc_Children_Single_Parents
                            );

              // remove the none class to display the element
              $('#pearsoninfo').removeClass('none').show();

              // populate our info window HTML elements with the relevant information using jQuery
              $('#pearsoninfo span').html('For percent of children in single-parent homes,');
              $(".Head span").html("the Pearson correlation coefficient is: ");
              $(".consumer span").html(data[0].Perc_Children_Single_Parents.toFixed(2) + ' with Consumer Protection Calls');
              $(".education span").html(data[1].Perc_Children_Single_Parents.toFixed(2) + ' with Education Calls');
              $(".employment span").html(data[2].Perc_Children_Single_Parents.toFixed(2) + ' with Employment Calls');
              $(".family span").html(data[3].Perc_Children_Single_Parents.toFixed(2) + ' with Family Calls');
              $(".minors span").html(data[4].Perc_Children_Single_Parents.toFixed(2) + ' with Minors Calls');
              $(".health span").html(data[5].Perc_Children_Single_Parents.toFixed(2) + ' with Health Calls');
              $(".housing span").html(data[6].Perc_Children_Single_Parents.toFixed(2) + ' with Housing Calls');
              $(".benefits span").html(data[7].Perc_Children_Single_Parents.toFixed(2) + ' with Benefits Calls');
              $(".individual span").html(data[8].Perc_Children_Single_Parents.toFixed(2) + ' with Individual Rights Calls');
              $(".miscellaneous span").html(data[9].Perc_Children_Single_Parents.toFixed(2) + ' with Misc/Other Calls');
              $(".pearsonspark").sparkline(array, {
                type: 'bar',
                height: '10.0em',
                barWidth: '12.0em',
                colorMap: ['#ff0000', '#ff7700', '#ffff00', '#77ff00', '#00ffff', '#0000ff', '#7700ff', '#ff00ff', '#ff0077', '#C0C0C0'],
              });

            }
          });
        });

        // on mouseout...
        layer.on("mouseout", function(e) {

          // reset style
          singleParents.resetStyle(e.target);

          // hide the info window by adding back the 'none' class
          $('#pearsoninfo').addClass('none').show

        });

      }
    });

    // baselayers from topojson using omnivore plugin
    var consumerCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, consumerLayer).addTo(map); // add the layer to the map
    var educationCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, educationLayer);
    var employCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, employLayer);
    var familyCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, famLayer);
    var minorsCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, minorsLayer);
    var healthCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, healthLayer);
    var housingCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, housingLayer);
    var benefitsCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, benefitsLayer);
    var individualCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, individualLayer);
    var miscCalls = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, miscLayer);

    // overlays from topojson using omnivore plugin
    var percFamsBelowPov = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, famsPov);
    var giniCo = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, gini);
    var highRent = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, rent);
    var percVet = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, veteran);
    var percForeignBorn = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, foreignBorn);
    var percUninsured = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, uninsured);
    var percSingleParents = omnivore.topojson('data/Iowa_ILA_Calls_by_County.json', null, singleParents);

    // designate the layers as grouped overlays
    var groupedOverlays = {
      "ILA Call Data": {
        "% of Calls for Consumer Protection": consumerCalls,
        "% of Calls for Education": educationCalls,
        "% of Calls for Employment/Tax": employCalls,
        "% of Calls for Family": familyCalls,
        "% of Calls for Minors": minorsCalls,
        "% of Calls for Health": healthCalls,
        "% of Calls for Housing": housingCalls,
        "% of Calls for Benefits": benefitsCalls,
        "% of Calls for Individual Rights": individualCalls,
        "% of Calls for Miscellaneous/Other": miscCalls,
        "Turn Off ILA Call Layers": L.geoJson(),
      },
      "US Census ACS Data": { // give each layer a name
        "% of Families in Poverty": percFamsBelowPov,
        "Gini Coefficient": giniCo,
        "% Households w/ Rent > 50% of Income": highRent,
        "% of Adults who are Veterans": percVet,
        "% Foreign Born": percForeignBorn,
        "% Without Health Insurance": percUninsured,
        "% of Children in Single-Parent Homes": percSingleParents,
        "Turn Off ACS Layers": L.geoJson(),
      }
    };

    // define options for the layer controls
    var options = {
      exclusiveGroups: ["US Census ACS Data", "ILA Call Data"],
      groupCheckboxes: true,
      collapsed: true,
    };

    // define the layer controls and send the grouped layers to it
    var layerControl = L.control.groupedLayers(null, groupedOverlays, options);

    // add the layer controls to the map
    map.addControl(layerControl);

    // when the mouse clicks on the document
    $(document).click(function(e) {

      // first offset from the mouse position of the info window
      $('#info').css({
        "left": e.pageX + 50,
        "top": e.pageY - 100
      });

      // if it crashes into the bottom, flip it up
      if ($('#info').offset().top > 300) {
        $('#info').css({
          "left": e.pageX + 50,
          "top": e.pageY - 275
        });
      }

      // if it crashes into the top, flip it lower right
      if ($('#info').offset().top < 100) {
        $('#info').css({
          "left": e.pageX + 50,
          "top": e.pageY + 30
        });
      }

      // if it crashes into the right, flip it to the left
      if ($('#info').offset().left + $('#info').width() >= $(document).width() - 40) {
        $('#info').css({
          "left": e.pageX - $('#info').width() - 110
        });
      }

    });

    var mapsTitle = L.control({
      position: 'topright' //place the maps window at top left corner
    });

    //when added to the map
    mapsTitle.onAdd = function(map) {

      var div = L.DomUtil.get("info_text"); //get the style settings

      return div; //return the style settings

    }

    mapsTitle.addTo(map); //add the maps title window to the map

    var map1button = L.easyButton({
      id: 'map1button',
      //position: 'topright',
      states: [{
        stateName: 'change-map',
        icon: '<strong>1</strong>',
        title: 'Go to Map 1: Where is Rural Iowa?',
        onClick: function(e) {
          window.location.href = 'index.html';
        }
      }]
    });

    map1button.addTo(map);

    var map2button = L.easyButton({
      id: 'map2button',
      //position: 'topleft',
      states: [{
        stateName: 'change-map',
        icon: '<strong>2</strong>',
        title: 'Go to Map 2: Attorneys by Zip Code',
        onClick: function(e) {
          window.location.href = 'index2.html';
        }
      }]
    });

    map2button.addTo(map);

    var infoButton = L.easyButton({
      id: 'infoButton',
      //position: 'topleft',
      states: [{
        stateName: 'show-info',
        icon: '<strong>?</strong>',
        title: 'Tell me about this map',
        onClick: function(btn, map) {
          $("#dialog").dialog();
        }
      }]
    });

    infoButton.addTo(map);

    // create legends for layers
    var consumerLegend = L.control({
      position: 'bottomright'
    });

    var educationLegend = L.control({
      position: 'bottomright'
    });

    var employLegend = L.control({
      position: 'bottomright'
    });

    var famLegend = L.control({
      position: 'bottomright'
    });

    var minorLegend = L.control({
      position: 'bottomright'
    });

    var healthLegend = L.control({
      position: 'bottomright'
    });

    var housingLegend = L.control({
      position: 'bottomright'
    });

    var benefitsLegend = L.control({
      position: 'bottomright'
    });

    var individualLegend = L.control({
      position: 'bottomright'
    });

    var miscLegend = L.control({
      position: 'bottomright'
    });

    var fampovLegend = L.control({
      position: 'bottomright'
    });

    var giniLegend = L.control({
      position: 'bottomright'
    });

    var rentLegend = L.control({
      position: 'bottomright'
    });

    var vetLegend = L.control({
      position: 'bottomright'
    });

    var foreignLegend = L.control({
      position: 'bottomright'
    });

    var uninsuredLegend = L.control({
      position: 'bottomright'
    });

    var singleLegend = L.control({
      position: 'bottomright'
    });

    // add content to the legend
    consumerLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [4.811, 8.64, 11.701, 14.61, 18.99],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Consumer Protection</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorProtect(grades[i] + 0.02) + '"></i> ' +
            (grades[i] + 0.01).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    educationLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [0.00, 0.21, 0.65, 1.09, 1.56],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Education</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorEd(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    employLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [0.00, 0.76, 2.39, 3.35, 4.53],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Employment/Tax</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorEmp(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    famLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [20.87, 25.60, 30.11, 34.92, 40.00],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Family</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorFam(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    minorLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [0.00, 1.33, 2.71, 4.23, 6.25],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Minors</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorMinors(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    healthLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [2.07, 5.10, 7.11, 9.26, 12.68],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Health</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorHealth(grades[i] + 0.02) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    housingLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [7.03, 17.33, 23.44, 27.64, 31.50],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Housing</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorHousing(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    benefitsLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [1.26, 5.73, 8.37, 10.24, 13.51],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Benefits</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorBenefits(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    individualLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [0.00, 0.01, 0.99, 1.69, 2.74],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Individual Rights</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorIndividual(grades[i] + 0.001) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    miscLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [1.26, 2.53, 4.23, 6.03, 8.21],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>ILA Calls for Misc./Other</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getColorMisc(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    fampovLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [3.00, 5.18, 7.07, 9.04, 11.50],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>Families in Poverty</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getShadeFams(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    giniLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [0.3764, 0.3920, 0.4185, 0.4409, 0.4744],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>Gini Coefficient</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getShadeGini(grades[i] + 0.0001) + '"></i> ' +
            (grades[i] + (0.0001 * (grades[i] / grades[i] || 0))).toFixed(4) + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(4) : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    rentLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [4.19, 8.50, 13.04, 17.61, 24.92],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>Household Rent > 50% of Income</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getShadeRent(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    vetLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [4.43, 6.06, 7.73, 8.97, 9.76],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>Adults who are Veterans</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getShadeVet(grades[i] + 0.02) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    foreignLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [0.17, 1.66, 3.28, 6.92, 12.89],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>Foreign Born</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getShadeForeign(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    uninsuredLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [1.79, 4.31, 5.99, 8.46, 12.53],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>Without Health Insurance</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getShadeUninsured(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add content to the legend
    singleLegend.onAdd = function(map) {

      var div = L.DomUtil.create('div', 'info legend'),
        grades = [10.68, 17.87, 23.89, 28.92, 33.35],
        labels = ["<h6 style='font-size:14px; font-weight:bold'>Children in Single-Parent-Homes</h6>"];

      // loop through our density intervals and generate a label with a colored square for each interval
      for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
          labels.push('<i style="background:' + getShadeSingle(grades[i] + 0.01) + '"></i> ' +
            (grades[i] + (0.01 * (grades[i] / grades[i] || 0))).toFixed(2) + '%' + (grades[i + 1] ? '&ndash;' + (grades[i + 1]).toFixed(2) + '%' : '+'));
        //grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+'));
      }
      div.innerHTML = labels.join('<br>');
      return div;
    };

    // add this legend to the map, because this legend is on by default
    consumerLegend.addTo(map);

    // when the user changes the baselayer, switch the legend
    map.on('overlayadd', function(eventLayer) {
      // Switch to the consumer protection legend
      if (eventLayer.name === '% of Calls for Consumer Protection') {
        this.removeControl(educationLegend).removeControl(employLegend)
            .removeControl(famLegend).removeControl(minorLegend)
            .removeControl(healthLegend).removeControl(housingLegend)
            .removeControl(benefitsLegend).removeControl(individualLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        consumerLegend.addTo(this);
        // Switch to the education legend
      }
      if (eventLayer.name === '% of Calls for Education') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(famLegend).removeControl(minorLegend)
            .removeControl(healthLegend).removeControl(housingLegend)
            .removeControl(benefitsLegend).removeControl(individualLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        educationLegend.addTo(this);
      } if (eventLayer.name === '% of Calls for Employment/Tax') {
        this.removeControl(consumerLegend).removeControl(educationLegend)
            .removeControl(famLegend).removeControl(minorLegend)
            .removeControl(healthLegend).removeControl(housingLegend)
            .removeControl(benefitsLegend).removeControl(individualLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        employLegend.addTo(this);
      } if (eventLayer.name === '% of Calls for Family') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(minorLegend)
            .removeControl(healthLegend).removeControl(housingLegend)
            .removeControl(benefitsLegend).removeControl(individualLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        famLegend.addTo(this);
      } if (eventLayer.name === '% of Calls for Minors') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(healthLegend).removeControl(housingLegend)
            .removeControl(benefitsLegend).removeControl(individualLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        minorLegend.addTo(this);
      }  if (eventLayer.name === '% of Calls for Health') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(housingLegend)
            .removeControl(benefitsLegend).removeControl(individualLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        healthLegend.addTo(this);
      } if (eventLayer.name === '% of Calls for Housing') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(benefitsLegend).removeControl(individualLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        housingLegend.addTo(this);
      } if (eventLayer.name === '% of Calls for Benefits') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(individualLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        benefitsLegend.addTo(this);
      } if (eventLayer.name === '% of Calls for Individual Rights') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(miscLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        individualLegend.addTo(this);
      } if (eventLayer.name === '% of Calls for Miscellaneous/Other') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(individualLegend).removeControl(fampovLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        miscLegend.addTo(this);
      } if (eventLayer.name === '% of Families in Poverty') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(individualLegend).removeControl(miscLegend)
            .removeControl(giniLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        fampovLegend.addTo(this);
      } if (eventLayer.name === 'Gini Coefficient') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(individualLegend).removeControl(miscLegend)
            .removeControl(fampovLegend).removeControl(rentLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        giniLegend.addTo(this);
      } if (eventLayer.name === '% Households w/ Rent > 50% of Income') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(individualLegend).removeControl(miscLegend)
            .removeControl(fampovLegend).removeControl(giniLegend)
            .removeControl(vetLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        rentLegend.addTo(this);
      } if (eventLayer.name === '% of Adults who are Veterans') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(individualLegend).removeControl(miscLegend)
            .removeControl(fampovLegend).removeControl(giniLegend)
            .removeControl(rentLegend).removeControl(foreignLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        vetLegend.addTo(this);
      } if (eventLayer.name === '% Foreign Born') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(individualLegend).removeControl(miscLegend)
            .removeControl(fampovLegend).removeControl(giniLegend)
            .removeControl(rentLegend).removeControl(vetLegend)
            .removeControl(uninsuredLegend).removeControl(singleLegend);
        foreignLegend.addTo(this);
      } if (eventLayer.name === '% Without Health Insurance') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(individualLegend).removeControl(miscLegend)
            .removeControl(fampovLegend).removeControl(giniLegend)
            .removeControl(rentLegend).removeControl(vetLegend)
            .removeControl(foreignLegend).removeControl(singleLegend);
        uninsuredLegend.addTo(this);
      } if (eventLayer.name === '% of Children in Single-Parent Homes') {
        this.removeControl(consumerLegend).removeControl(employLegend)
            .removeControl(educationLegend).removeControl(famLegend)
            .removeControl(minorLegend).removeControl(healthLegend)
            .removeControl(housingLegend).removeControl(benefitsLegend)
            .removeControl(individualLegend).removeControl(miscLegend)
            .removeControl(fampovLegend).removeControl(giniLegend)
            .removeControl(rentLegend).removeControl(vetLegend)
            .removeControl(foreignLegend).removeControl(uninsuredLegend);
        singleLegend.addTo(this);
      }
    });

  </script>
</body>

</html>
