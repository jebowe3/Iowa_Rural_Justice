<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Iowa Rural Justice Project</title>
  <link rel="icon" type="image/jpg" href="images/icon.jpg" />
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <!-- for button-dependent map information window -->
  <link rel='stylesheet' href='https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css'>

  <link href='https://api.mapbox.com/mapbox-assembly/v0.24.0/assembly.min.css' rel='stylesheet'>
  <link href='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.css' rel='stylesheet' />
  <link href="https://fonts.googleapis.com/css?family=Rubik&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="src/easy-button.css">

  <style type="text/css">
    h1 {
      font-size: 30px;
      font-family: 'Rubik', sans-serif;
      display: inline-block;
      color: white;
      margin-left: 18px;
      margin-right: 30px;
      padding-top: 20px;
      padding-bottom: 10px;
    }

    h2 {
      font-size: 14px;
      font-family: 'Rubik', sans-serif;
      padding-bottom: 0px;
      padding-top: 0px;
    }

    h3 {
      font-size: 12px;
      font-family: 'Rubik', sans-serif;
      padding-top: 0px;
    }

    h4 {
      font-size: 14px;
      font-family: 'Rubik', sans-serif;
      display: inline-block;
      margin-right: 16px;
      margin-left: 19px;
      padding-bottom: 1px;
      color: white;
    }

    h5 {
      font-size: 14px;
      font-family: 'Rubik', sans-serif;
      padding-bottom: 0px;
      padding-top: 4px;
    }

    body {
      margin: 0px;
      height: 100%;
      width: 100%;
    }

    /* Add banner to header background */
    header {
      background-image: url('images/Iowa_Prairie.jpg');
      position: fixed;
      width: 100%;
      height: 100px;
      background-color: #000000;
      box-shadow: 0px 5px 5px black;
      z-index: 800;
    }

    /* Set map parameters */
    #map {
      position: fixed;
      top: 100px;
      bottom: 0px;
      width: 100%;
    }

    #info_text {
      background-color: #FFFFFF;
      padding-bottom: 10px;
      padding-left: 5px;
      height: 30px;
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      position: absolute;
      top: 105px;
      right: 133px;
    }

    #map2button {
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      position: fixed;
      z-index: 1000;
      top: 215px;
      right: 100px;
    }

    #infoButton {
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
      position: fixed;
      z-index: 1000;
      top: 215px;
      right: 12px;
    }

    .leaflet-control-layers-expanded {
      font-family: 'Rubik', sans-serif;
      font-size: 12px;
    }

  </style>
</head>

<body>
  <header>
    <h1>Iowa Rural Justice Project: Where is Rural Iowa?</h1><br>
    <h4>Map by Jay Bowen, 2020 | University of Iowa Digital Scholarship & Publishing Studio</a></h4>
  </header>
  <div id="map"></div>

  <!-- maps title -->
  <div id='info_text' class='px12 round wmax200'>
    <h5 class='txt-bold'>Maps:</h5>
  </div>
  <!-- end maps title -->

  <!-- button-dependent info window -->
  <div id="dialog" title="Where is Rural Iowa?">
    <h3>One of the fundamental issues for our project is to define which parts of
      Iowa can be considered rural. This map shows how different organizations
      differentiate between rural and urban. Toggle the layer controls in the
      upper right corner to see which parts of Iowa are considered rural and urban
      by the Office of Management and Budget and the US Census Bureau. Click on
      the map polygons for more detailed information. You can also cycle through
      other maps in the project by clicking on the numbered buttons below the
      layer controls.</h3>
  </div>
  <!-- end button-dependent info window -->

  <!-- load scripts -->
  <script src='https://api.mapbox.com/mapbox-assembly/v0.24.0/assembly.js'></script>
  <script src='https://api.mapbox.com/mapbox.js/v3.2.1/mapbox.js'></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <!-- for button-dependent map information window -->
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <script src="src/easy-button.js"></script>

  <script type="text/javascript">
    // Initialize the map
    var map = L.map('map').setView([42.05, -93.5], 8);

    // Load tile layer
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
    	subdomains: 'abcd',
    	maxZoom: 16,
      minZoom: 7,
    }).addTo(map);

    // fit map to Iowa
    map.fitBounds([
      [43.50102, -90.14006],
      [40.37544, -96.63967]
    ]);

    // add a scale bar
    L.control.scale().addTo(map); // Initialize the map

    // load the data asynchronously
    // OMB and Census urban area polygons from: https://catalog.data.gov/dataset
    d3.queue()
      .defer(d3.json, 'data/Iowa_Counties.geojson')
      .defer(d3.json, 'data/Iowa_OMB_Rural.geojson')
      .defer(d3.json, 'data/Iowa_OMB_Urban.geojson')
      .defer(d3.json, 'data/Iowa_USCensus_Rural.geojson')
      .defer(d3.json, 'data/Iowa_USCensus_Urban.geojson')
      .await(drawMap); // load the data asynchronously

    // define drawMap function
    function drawMap(err, counties, ombrural, omburban, censusrural, censusurban) {

      var iowaCounties = L.geoJson(counties, {

        // style the layer
        style: function(feature) {

          return {
            stroke: 0.5,
            color: 'grey',
            strokeOpacity: 0.75,
            weight: 0.5,
            fillColor: 'rgba(0,0,0,0.0)',
            fillOpacity: 0.0,
            smoothFactor: 0.99
          };
        },

        onEachFeature: function(feature, layer) {
          // bind a popup window
          layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, ' + feature.properties.ST +
            '</b></h2><h3>Area: ' + feature.properties.Area_SqMi.toFixed(2) + ' sq mi</h3>');
          // change layer style on mouseover
          layer.on("mouseover", function(e) {
            layer.setStyle({
              color: 'yellow',
              weight: 3,
              opacity: 0.5,
              smoothFactor: 0.99
            });
          });
          // reset style on mouseout
          layer.on("mouseout", function(e) {
            iowaCounties.resetStyle(e.target);
          });

        }

      }).addTo(map); // add the layer to the map

      var iowaOmbRural = L.geoJson(ombrural, {

        // style the layer
        style: function(feature) {
          return {
            stroke: 0.5,
            color: '#FFFF66',
            strokeOpacity: 0.75,
            weight: 0.5,
            fillColor: '#FFFF66',
            fillOpacity: 0.5,
            smoothFactor: 0.99
          };
        },

        onEachFeature: function(feature, layer) {
          // bind a popup window
          layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, ' + feature.properties.ST +
            '</b></h2><h3>Area: ' + feature.properties.Area_SqMi.toFixed(2) + ' sq mi</h3>');
          // change layer style on mouseover
          layer.on("mouseover", function(e) {
            layer.setStyle({
              stroke: 1.0,
              color: '#FFFF00',
              strokeOpacity: 1.0,
              weight: 1.0,
              fillColor: '#FFFF00',
              fillOpacity: 0.75,
              smoothFactor: 0.99
            });
          });
          // reset style on mouseout
          layer.on("mouseout", function(e) {
            iowaOmbRural.resetStyle(e.target);
          });

        }

      }).addTo(map); // add the layer to the map

      var iowaOmbUrban = L.geoJson(omburban, {

        // style the layer
        style: function(feature) {
          return {
            stroke: 0.5,
            color: '#87CEFA',
            strokeOpacity: 0.75,
            weight: 0.5,
            fillColor: '#87CEFA',
            fillOpacity: 0.5,
            smoothFactor: 0.99
          };
        },

        onEachFeature: function(feature, layer) {
          // bind a popup window
          layer.bindPopup('<h2><b>' + feature.properties.NAMELSAD +
            '</b></h2><h3>Area: ' + feature.properties.sqmi.toFixed(2) + ' sq mi</h3>');
          // change layer style on mouseover
          layer.on("mouseover", function(e) {
            layer.setStyle({
              stroke: 0.5,
              color: '#4169E1',
              strokeOpacity: 0.75,
              weight: 0.5,
              fillColor: '#4169E1',
              fillOpacity: 0.5,
              smoothFactor: 0.99
            });
          });
          // reset style on mouseout
          layer.on("mouseout", function(e) {
            iowaOmbUrban.resetStyle(e.target);
          });

        }

      }); // end iowaOmbUrban

      var USCensusRural = L.geoJson(censusrural, {

        // style the layer
        style: function(feature) {
          return {
            stroke: 0.5,
            color: '#FFFF66',
            strokeOpacity: 0.75,
            weight: 0.5,
            fillColor: '#FFFF66',
            fillOpacity: 0.5,
            smoothFactor: 0.99
          };
        },

        onEachFeature: function(feature, layer) {
          // bind a popup window
          layer.bindPopup('<h2><b>' + feature.properties.COUNTY + ' County, ' + feature.properties.ST +
            '</b></h2><h3>Area: ' + feature.properties.Area_SqMi.toFixed(2) + ' sq mi' +
            '</br>Percent Rural: ' + feature.properties.Perc_Rural + '%</h3>');
          // change layer style on mouseover
          layer.on("mouseover", function(e) {
            layer.setStyle({
              stroke: 1.0,
              color: '#FFFF00',
              strokeOpacity: 1.0,
              weight: 1.0,
              fillColor: '#FFFF00',
              fillOpacity: 0.75,
              smoothFactor: 0.99
            });
          });
          // reset style on mouseout
          layer.on("mouseout", function(e) {
            USCensusRural.resetStyle(e.target);
          });

        }

      }); // end USCensusRural

      var USCensusUrban = L.geoJson(censusurban, {

        // style the layer
        style: function(feature) {
          return {
            stroke: 0.5,
            color: '#87CEFA',
            strokeOpacity: 0.75,
            weight: 0.5,
            fillColor: '#87CEFA',
            fillOpacity: 0.5,
            smoothFactor: 0.99
          };
        },

        onEachFeature: function(feature, layer) {
          // bind a popup window
          layer.bindPopup('<h2><b>' + feature.properties.NAMELSAD10 +
            '</b></h2><h3>Area: ' + feature.properties.sqmi.toFixed(2) + ' sq mi</h3>');
          // change layer style on mouseover
          layer.on("mouseover", function(e) {
            layer.setStyle({
              stroke: 0.5,
              color: '#4169E1',
              strokeOpacity: 0.75,
              weight: 0.5,
              fillColor: '#4169E1',
              fillOpacity: 0.5,
              smoothFactor: 0.99
            });
          });
          // reset style on mouseout
          layer.on("mouseout", function(e) {
            USCensusUrban.resetStyle(e.target);
          });

        }

      }); // end USCensusUrban

      // designate the layers as baselayers (allows only one open at a time)
      var baselayers = {
        "OMB Rural Areas": iowaOmbRural,
        "US Census Rural Areas": USCensusRural,
        "OMB Urban Areas": iowaOmbUrban,
        "US Census Urban Areas": USCensusUrban,
      };

      // all done with the layers, add them to layer control
      L.control.layers(baselayers, null, {
        collapsed: false,
      }).addTo(map);

      // if the browser is Chrome or Safari...
      if ( L.Browser.webkit ) {
        $('.leaflet-control-layers-expanded').css({ 'width': '199px'});
      } else if ( L.Browser.ie ) { // if the browser is Internet Explorer...
        $('.leaflet-control-layers-expanded').css({ 'width': '200px'});
      } else if (L.Browser.edge) { // if the browser is Microsoft Edge...
        $('.leaflet-control-layers-expanded').css({ 'width': '200px'});
      } else { // otherwise...
        $('.leaflet-control-layers-expanded').css({ 'width': '202px'});
      };

      var mapsTitle = L.control({
        position: 'topright' //place the maps window at top left corner
      });

      //when added to the map
      mapsTitle.onAdd = function(map) {

        var div = L.DomUtil.get("info_text"); //get the style settings

        return div; //return the style settings

      }

      mapsTitle.addTo(map); //add the filter window to the map

      var map2button = L.easyButton({
        id: 'map2button',
        //position: 'topleft',
        states: [{
          stateName: 'change-map',
          icon: '<strong>2</strong>',
          title: 'Go to Map 2: Attorneys by Zip Code',
          onClick: function(e) {
            window.location.href = 'index2.html';
          }
        }]
      });

      map2button.addTo(map);

      var infoButton = L.easyButton({
        id: 'infoButton',
        //position: 'topleft',
        states: [{
          stateName: 'show-info',
          icon: '<strong>?</strong>',
          title: 'Tell me about this map',
          onClick: function(btn, map){
            $("#dialog").dialog();
          }
        }]
      });

      infoButton.addTo(map);

    }; // end drawMap function

  </script>
</body>

</html>
